/*
Copyright (c) 2016, Alihan Livdumlu.  All rights reserved.
Copyrights licensed under MIT License. See the accompanying LICENSE file for terms.
*/

var should = require('chai').should();
var math3d = require('../index'),
    Vector3 = math3d.Vector3,
    Quaternion = math3d.Quaternion;
var dEqual = require('../src/util').doublesEqual;

var easyQuaternion = new Quaternion(0,0,3,4);
var invsqrt2 = 1/Math.sqrt(2);

describe("Quaternion(0,0,3,4)", function(){
  it("equals Quaternion(0,0,0.6,0.8)", function() {
    easyQuaternion.equals(new Quaternion(0,0,0.6,0.8)).should.equal(true);
  });

  it("has x 0", function() {
    easyQuaternion.x.should.equal(0);
  });

  it("has y 0", function() {
    easyQuaternion.y.should.equal(0);
  });

  it("has z 0.6", function() {
    easyQuaternion.z.should.equal(0.6);
  });

  it("has w 0.8", function() {
    easyQuaternion.w.should.equal(0.8);
  });

  it("has conjugate/inverse (0,0,-0.6,0.8)", function() {
    easyQuaternion.conjugate().equals(new Quaternion(0,0,-0.6,0.8)).should.equal(true);
    easyQuaternion.inverse().equals(new Quaternion(0,0,-0.6,0.8)).should.equal(true);
  });

  it("has dot product 0.8 with Quaternion.identity", function() {
    easyQuaternion.dot(Quaternion.identity).should.equal(0.8);
  });

  it("has distance 0 to itself", function() {
    easyQuaternion.distanceTo(easyQuaternion).should.equal(0);
  });

  it("has angle 0 to itself", function() {
    easyQuaternion.angleTo(easyQuaternion).should.equal(0);
  });
});

describe("Quaternion", function() {
  it("equals (x: 1/sqrt(2), y: 0, z: 0, w: 1/sqrt(2)) for euler angles (90,0,0)", function() {
    Quaternion.Euler(90,0,0).equals(new Quaternion(invsqrt2,0,0,invsqrt2)).should.equal(true);
  });

  it("equals (x: 0, y: 1/sqrt(2), z: 0, w: 1/sqrt(2)) for euler angles (0,90,0)", function() {
    Quaternion.Euler(0,90,0).equals(new Quaternion(0,invsqrt2,0,invsqrt2)).should.equal(true);
  });

  it("equals (x: 0, y: 0, z: 1/sqrt(2), w: 1/sqrt(2)) for euler angles (0,0,90)", function() {
    Quaternion.Euler(0,0,90).equals(new Quaternion(0,0,invsqrt2,invsqrt2)).should.equal(true);
  });

  it("equals (x: 0.375, y: 0.166, z: 0.283, w: 0.867) for euler angles (40,30,25,XYZ)", function() {
    Quaternion.Euler(40,30,25,"XYZ").equals(new Quaternion(0.26989474054734813,0.30894959935305055,0.1100334560435672,0.9053174098820688)).should.equal(true);
  });

  it("moves Vector.right to Vector.up for euler angles (0,0,90)", function() {
    Quaternion.Euler(0,0,90).mulVector3(Vector3.right).equals(Vector3.up).should.equal(true);
  });

  it("moves Vector.right to Vector.up for euler angles (0,90,90)", function() {
    Quaternion.Euler(0,90,90).mulVector3(Vector3.right).equals(Vector3.up).should.equal(true);
  });

  it("moves Vector.right to Vector.forward for euler angles (90,0,90)", function() {
    Quaternion.Euler(90,0,90).mulVector3(Vector3.right).equals(Vector3.forward).should.equal(true);
  });

  it("does not move Vector.right for euler angles (90,0,90)", function() {
    Quaternion.Euler(90,90,90).mulVector3(Vector3.right).equals(Vector3.right).should.equal(true);
  });

  it("equals euler angles (0,90,0) for angle 90 around axis (0,1,0)", function() {
    Quaternion.AngleAxis(Vector3.up, 90).equals(Quaternion.Euler(0,90,0)).should.equal(true);
  });

  it("returns the same angle axis representation as created from 90 degrees around Vector.up", function() {
    var angleAxis = Quaternion.AngleAxis(Vector3.up, 90).angleAxis;
    angleAxis.axis.equals(Vector3.up).should.equal(true);
    angleAxis.angle.should.equal(90);
  });

  it("equals two Vectors Up and Down for euler angles (0,0,180)", function() {
    Quaternion.TwoVectors(Vector3.up, Vector3.down).equals(Quaternion.Euler(0,0,180)).should.equal(true);
  });

  it("equals two Vectors Up and Up for Identity Quaternion", function() {
    Quaternion.TwoVectors(Vector3.up, Vector3.up).equals(Quaternion.identity).should.equal(true);
  });

  it("equals two Vectors Up and Right for euler angles (0,0,-90)", function() {
    Quaternion.TwoVectors(Vector3.up, Vector3.right).equals(Quaternion.Euler(0,0,-90)).should.equal(true);
  });

  it("equals two Vectors Up and Forward for euler angles (90,0,0)", function() {
    Quaternion.TwoVectors(Vector3.up, Vector3.forward).equals(Quaternion.Euler(90,0,0)).should.equal(true);
  });

  it("equals average of (0.017, 0, 0, 1) and (-0.017, 0, 0, 1) for identity quaternion", function() {
    Quaternion.AverageOfQuaternions([new Quaternion(0.017, 0, 0, 1), new Quaternion(-0.017, 0, 0, 1)]).equals(Quaternion.identity).should.equal(true);
  });

  it("equals average of 8 quaternions for identity quaternion", function() {
    Quaternion.AverageOfQuaternions([new Quaternion(0.017, 0, 0, 1), new Quaternion(-0.017, 0, 0, 1), new Quaternion(0, 0.017, 0, 1), new Quaternion(0, -0.017, 0, 1), new Quaternion(0.017, 0.017, -0.000305, 1), new Quaternion(0.017, -0.017, 0.000305, 1), new Quaternion(-0.017, 0.017, 0.000305, 1), new Quaternion(-0.017, -0.017, -0.000305, 1)]).equals(Quaternion.identity).should.equal(true);
  });
  it("equals average of 4 quaternions for (0.1104, 0.8866, -0.0341, 0.4479)", function() {
    Quaternion.AverageOfQuaternions([new Quaternion(0.10297483417688628, 0.8814428707420268, -0.03413231031245159, 0.45966252244122763), new Quaternion(0.10830385895165914, 0.8944101079825333, -0.025044369512129457, 0.43321312587523503), new Quaternion(0.10252539031308919, 0.8815616941381494, -0.03554040185251982, 0.45942834436458757), new Quaternion(0.10736656208641421, 0.8946767516211049, -0.027546480475525405, 0.4327437149952192)]).equals(new Quaternion(0.10530555461967625, 0.8881316042335635, -0.030569636134896917, 0.4463165816708352)).should.equal(true);
  });
  it("equals average of x quaternions for (0.1657, 0.8748, -0.0665, 0.4503)", function() {
    let avg = Quaternion.AverageOfQuaternions([new Quaternion(0.1397311477006402, 0.8725280263384836, -0.052241626941058536, 0.4652320518092921), new Quaternion(0.14105514199473101, 0.886523495233443, -0.05166950091832098, 0.4376183291302796), new Quaternion(0.14118585878292766, 0.8723528351193202, -0.050282340743365614, 0.4653372653768229), new Quaternion(0.14076983187833628, 0.8865276094861436, -0.052807144818559956, 0.4375660607357938), new Quaternion(0.14198188007161291, 0.8723353524048789, -0.04972974593094338, 0.46518720000192365), new Quaternion(0.13998204508216744, 0.886534268236502, -0.05529800572413828, 0.4374975986904581), new Quaternion(0.14075829323324604, 0.8723212795341748, -0.05304504416883188, 0.46521920795153154), new Quaternion(0.14223974329156033, 0.8863341981461882, -0.05183176487020116, 0.4375991462232814), new Quaternion(0.14120983369201137, 0.8722438512121495, -0.05335679991194779, 0.4651918945923591), new Quaternion(0.14327615639310673, 0.8862630514900802, -0.051058644930065455, 0.437496012953964), new Quaternion(0.14306427427012586, 0.8720438230269694, -0.05051627234849802, 0.46531740820227496), new Quaternion(0.14223029355129976, 0.8861803669075476, -0.05385653814210266, 0.43766925206514523), new Quaternion(0.14251113587995323, 0.8719518931563861, -0.05258367241684225, 0.4654303702664429), new Quaternion(0.14284742206218173, 0.8861293052622401, -0.053633355831118695, 0.43759905336728205), new Quaternion(0.14184941521699454, 0.8720437419455225, -0.054395869539064994, 0.46525213047694564), new Quaternion(0.14159535392998482, 0.8862690692976696, -0.05594868854426017, 0.4374330083588371), new Quaternion(0.14293482951731773, 0.872156405576199, -0.05297166757893961, 0.4648729301187222), new Quaternion(0.14447031431219853, 0.8861214782830475, -0.05142996446819991, 0.43734655910707804), new Quaternion(0.1423951167263039, 0.872155520347509, -0.05488607640133407, 0.46481813398052274), new Quaternion(0.14344609412128392, 0.8862562882148921, -0.05404145470057189, 0.43709556261160565), new Quaternion(0.1444950217031851, 0.8720750562437178, -0.05106334916085985, 0.4647567313692065), new Quaternion(0.14352346731610582, 0.8862996085157276, -0.054551725787920446, 0.43691890264440403), new Quaternion(0.14577970077753577, 0.8720398139977135, -0.04947134900951734, 0.46459383042742197), new Quaternion(0.14317191364254533, 0.8861877982397887, -0.056501553953034495, 0.4370132306872865), new Quaternion(0.14610259650607899, 0.8719753974182868, -0.04995942074435541, 0.4645610765769031), new Quaternion(0.14291329878872383, 0.8861161475094024, -0.058029129768369714, 0.43704299817151376), new Quaternion(0.14751730969410623, 0.8720500322063508, -0.048916016586978306, 0.464084699156068), new Quaternion(0.14129727646490908, 0.8857349712005129, -0.06296718251523084, 0.43765714250097565), new Quaternion(0.14858682033655318, 0.8721935590428972, -0.048358295485078244, 0.46353190574558645), new Quaternion(0.14319951322553334, 0.8861750141945425, -0.06003399096007689, 0.43655888899285766), new Quaternion(0.14772387403462905, 0.8722215444722128, -0.05043685814495159, 0.4635335562169958), new Quaternion(0.14509214889850391, 0.8863221907743388, -0.05744520440313473, 0.4359831315086319), new Quaternion(0.1465223310381801, 0.8719615915088944, -0.05422572549968589, 0.46397603400870485), new Quaternion(0.14646377403969518, 0.8860635371825472, -0.05594608356339672, 0.43624512226902834), new Quaternion(0.14509560931732643, 0.8720540175449434, -0.057445090386185234, 0.4638632516497513), new Quaternion(0.1502928846989637, 0.8852464031156166, -0.04890837340837971, 0.43744579731696337), new Quaternion(0.14481107063251494, 0.872098590726468, -0.05924391380064637, 0.46364206081065895), new Quaternion(0.1498723311909424, 0.8854080025002434, -0.05078142875528964, 0.4370494250602475), new Quaternion(0.14612529371501465, 0.8718725232283249, -0.05745645271875986, 0.4638797881101869), new Quaternion(0.14846810396678373, 0.8858253443608083, -0.054884503560750045, 0.43618616743479366), new Quaternion(0.14900879570141315, 0.8715665978663177, -0.0530820431468512, 0.46405855339892493), new Quaternion(0.14707207620529783, 0.8857661308449293, -0.05862835429835981, 0.43629219786850726), new Quaternion(0.1495118953292076, 0.8715991593201786, -0.05318693106979648, 0.46382351060592286), new Quaternion(0.14498931516262267, 0.8855828461931855, -0.06384709724559386, 0.43662875442458243), new Quaternion(0.1508239629946237, 0.871709559798682, -0.05220148329322458, 0.46330290381582084), new Quaternion(0.14762420833548237, 0.8858093283591939, -0.060267939096254365, 0.4357943350047661), new Quaternion(0.14992808183402254, 0.871555470851791, -0.05522572715009297, 0.46353290127738184), new Quaternion(0.15118559693940678, 0.885609619376614, -0.054470281730009416, 0.43574247641690583), new Quaternion(0.1473934444488357, 0.8719966400414281, -0.06138892333482615, 0.46274013482921367), new Quaternion(0.15421205147137632, 0.8847168493952315, -0.05015628314193354, 0.43701154085281435), new Quaternion(0.14626115651405505, 0.8726093774844025, -0.06555746833151252, 0.4613705308831692), new Quaternion(0.15544887434310725, 0.8841463438868464, -0.04892203273656613, 0.43786701722087434), new Quaternion(0.14688587791938099, 0.872369081724256, -0.06554866177076007, 0.461627660630831), new Quaternion(0.1561855462077353, 0.8839308284381013, -0.048711454456237153, 0.4380634199488486), new Quaternion(0.14937796643874152, 0.8713094361078902, -0.06115128741167004, 0.46342918524826643), new Quaternion(0.15466322772906996, 0.884478726466364, -0.05232667754916234, 0.43707961200853396), new Quaternion(0.1499576973699612, 0.871203499643617, -0.06097565769171815, 0.4634642600862293), new Quaternion(0.15456936061474433, 0.884664029469755, -0.0535697121919766, 0.436586937112363), new Quaternion(0.1510225020539402, 0.8710557353198957, -0.059875450134577284, 0.4635396857992478), new Quaternion(0.153630211982238, 0.8848621783775046, -0.05634261429228848, 0.436167620368615), new Quaternion(0.15102060722149352, 0.8710877241118509, -0.06089357862647129, 0.4633475209582428), new Quaternion(0.15551839199665013, 0.8844864108283697, -0.05408830550393019, 0.4365458441199942), new Quaternion(0.1517004288200323, 0.8710000046757347, -0.06082428371552714, 0.4632994477238037), new Quaternion(0.15655815528583278, 0.8843389446103292, -0.05323905065891835, 0.4365773454313947), new Quaternion(0.1520527025854019, 0.8709446647806116, -0.061243955585895064, 0.4632327108817516), new Quaternion(0.1567565673773658, 0.8842961107754729, -0.053740648864541586, 0.43653145328951515), new Quaternion(0.15241972796358783, 0.8708968430079304, -0.061541886301886235, 0.4631625110009787), new Quaternion(0.15637131581127975, 0.8844509457868169, -0.05550946366665526, 0.4361344236949136), new Quaternion(0.15230531491848276, 0.8709848624221069, -0.06275649218185046, 0.46287156228067705), new Quaternion(0.1580113543598794, 0.8840452252131706, -0.05279062241695908, 0.43670310493054804), new Quaternion(0.1525156351903004, 0.8709158639501187, -0.06280142190558087, 0.46292604198635745), new Quaternion(0.1596378568503427, 0.8834159737933325, -0.05044411377141339, 0.43766124262130457), new Quaternion(0.1530037901426176, 0.870694274438186, -0.06250163457963312, 0.4632222645096289), new Quaternion(0.15673983579502385, 0.8842666246308507, -0.05630276017067416, 0.436274179428573), new Quaternion(0.15505946777401985, 0.8703425298022387, -0.059041718739085126, 0.4636534457107073), new Quaternion(0.15238686806012952, 0.8845020476856601, -0.06566729739898332, 0.43603001747014236), new Quaternion(0.15799938425914073, 0.8704901854435451, -0.05429447006783018, 0.4629634349927089), new Quaternion(0.15379099787923528, 0.8845482759086853, -0.06423577490422878, 0.43565633448939406), new Quaternion(0.15702180808215743, 0.8704041121005779, -0.057000442614791307, 0.4631325760154782), new Quaternion(0.15580595513401066, 0.8845772109143154, -0.06159586042561878, 0.43526269338671475), new Quaternion(0.15596150953619112, 0.8702497374174131, -0.06063786244092949, 0.46331895245792737), new Quaternion(0.15939864921059563, 0.8838529496084399, -0.055732285897196615, 0.4362223589030845), new Quaternion(0.15356867522023548, 0.8708275274920083, -0.06649477874543858, 0.4622277834064637), new Quaternion(0.1602024534912271, 0.8835448600116402, -0.05491918248911488, 0.436654941157351), new Quaternion(0.15601670633123335, 0.8699839514719769, -0.06260422655000887, 0.4635379405667176), new Quaternion(0.16017988836714697, 0.8834918355993401, -0.056413867125097814, 0.4365799530303573), new Quaternion(0.15565620599363184, 0.8700488786589279, -0.06440485331992185, 0.4632905234826737), new Quaternion(0.1614626878853706, 0.8831070576932555, -0.05483638737358491, 0.4370865997637162), new Quaternion(0.15495911630407638, 0.8702618236713295, -0.0665367251262459, 0.46282274657149897), new Quaternion(0.16407694580337812, 0.8819580319127232, -0.050492326461165346, 0.438952515392053), new Quaternion(0.1537775588964313, 0.8710657269722705, -0.0704225177765433, 0.4611264801159624), new Quaternion(0.1650868118572663, 0.8813199463711857, -0.049654032111800216, 0.4399499673532595), new Quaternion(0.15441158069875296, 0.870633065675811, -0.0698044688693545, 0.4618251452919374), new Quaternion(0.16484934948586752, 0.8814986821892669, -0.0510011973371636, 0.4395266125536063), new Quaternion(0.1535493950657978, 0.8712504093333964, -0.07293356876452628, 0.4604628128943607), new Quaternion(0.16697258001408977, 0.8800327520574033, -0.048269052998427486, 0.44196449105368907), new Quaternion(0.1546456508967903, 0.8705291452823539, -0.07165812551073489, 0.4616587949134838), new Quaternion(0.1640728334523604, 0.8818856202864029, -0.05400426232805994, 0.4386814307733832), new Quaternion(0.15599197001133808, 0.8698528837159336, -0.06959908748265199, 0.4627941583518945), new Quaternion(0.16579554893499157, 0.881300090374275, -0.05248890247780129, 0.43939378895964787), new Quaternion(0.15587483826438403, 0.8701444491221617, -0.07152062384263434, 0.4619918536328344), new Quaternion(0.16633376300135172, 0.8810455180307238, -0.052642455426670225, 0.4396824380509582), new Quaternion(0.15522979276068272, 0.8705109342692375, -0.07364700200878585, 0.46118385038105225), new Quaternion(0.1671742502324158, 0.8805159738573236, -0.05219897246642902, 0.4404766249357255), new Quaternion(0.1562142457144024, 0.8700054592145974, -0.07308992854031814, 0.46189335643484764), new Quaternion(0.16715562231570644, 0.8806785594009074, -0.05324914992645507, 0.4400327271600389), new Quaternion(0.1564039581317534, 0.8698546851383939, -0.07354780612444436, 0.46204041905204307), new Quaternion(0.1678988609119114, 0.8801821626522831, -0.052865936627644425, 0.4407885272981985), new Quaternion(0.1566061461789572, 0.8698385326959984, -0.07463860891950351, 0.4618273704262332), new Quaternion(0.16810313783901318, 0.8799386697824525, -0.05308891292818644, 0.44116985367800143), new Quaternion(0.15753838770516132, 0.8690327282027018, -0.07289453983285034, 0.4633035287739393), new Quaternion(0.16912955382481606, 0.8792144308830983, -0.05166090340842021, 0.442389341653881), new Quaternion(0.1548536331112355, 0.8714182117056825, -0.07931843412061272, 0.4586493634886844), new Quaternion(0.16899968193967146, 0.8793178392976552, -0.052565107922266124, 0.44212685331962537), new Quaternion(0.15582145761046703, 0.8705746352407181, -0.07795366653835684, 0.4601550865706765), new Quaternion(0.1689945957941442, 0.8794955390793613, -0.05338022348897343, 0.4416774559247336), new Quaternion(0.15656051965766646, 0.8699071253608724, -0.07676852584550752, 0.46136427079956294), new Quaternion(0.1693434228313478, 0.879357148076149, -0.05369532193318583, 0.44178119434131286), new Quaternion(0.15643080521477257, 0.8702111622867148, -0.07844061150344854, 0.4605529358048084), new Quaternion(0.17047868288605875, 0.878321605931658, -0.05224194875889374, 0.4435751954572537), new Quaternion(0.15692926423141754, 0.8698850624156621, -0.07883278889156582, 0.4609322896147152), new Quaternion(0.1703151159979505, 0.8787571905566623, -0.054099927407490825, 0.44255141979443563), new Quaternion(0.15754024299519043, 0.8695001408479774, -0.07876137468096822, 0.4614620491012538), new Quaternion(0.171328625973265, 0.8780253251913608, -0.05336562288191005, 0.44370050770665564), new Quaternion(0.1564906930526529, 0.8707690305566507, -0.08175825014984384, 0.45889818799355325), new Quaternion(0.17119070395433772, 0.8783208817112452, -0.054672737022677394, 0.44300910087271156), new Quaternion(0.15789903927971596, 0.8695628727161847, -0.080249192684295, 0.46096460912052434), new Quaternion(0.17100170338410933, 0.8787495781148736, -0.05639134269970453, 0.4420153989073109), new Quaternion(0.16184370728883074, 0.8670797912956041, -0.07344510210865329, 0.46538700767643754), new Quaternion(0.16894245220291687, 0.8798445675281952, -0.06135870908994485, 0.43996260483546057), new Quaternion(0.1626485008695905, 0.8668753821087803, -0.07289999891845889, 0.46557290214994224), new Quaternion(0.16848223262734252, 0.8799973810386591, -0.06272655578626048, 0.4396404506562155), new Quaternion(0.16447408154183168, 0.8662520185071867, -0.06953839948798976, 0.46660489488414536), new Quaternion(0.16876367438288278, 0.8799334004814864, -0.06273402948942197, 0.4396594983278502), new Quaternion(0.1662745284447195, 0.865929205386716, -0.06657720558299102, 0.4669977174950397), new Quaternion(0.16736701362003567, 0.880111724662668, -0.06653773564942217, 0.43927709318591), new Quaternion(0.16837141103425998, 0.8657225858958845, -0.06343267426231994, 0.467067198647053), new Quaternion(0.1668050490273082, 0.8800660061512637, -0.06809237188686341, 0.4393442037022706), new Quaternion(0.17079441244324728, 0.8658003144844096, -0.05935896482284072, 0.4665786079665719), new Quaternion(0.16606204080054732, 0.8799549704486381, -0.0702862043267971, 0.4395025575229631), new Quaternion(0.17090259066038774, 0.8656605314867358, -0.060574510389784356, 0.4666421299268937), new Quaternion(0.16639131287207692, 0.8799278475311806, -0.07116118052729196, 0.43929147558974146), new Quaternion(0.1726361174662019, 0.8660681038999061, -0.05792562562866116, 0.4655828951421492), new Quaternion(0.16725669909689872, 0.8801730474232817, -0.07041149719433179, 0.43859186524566934), new Quaternion(0.1729720990738097, 0.8661074085888415, -0.05892240318706381, 0.4652598845077693), new Quaternion(0.16733645183263327, 0.8801413081988544, -0.07180271225277797, 0.4383995437990544), new Quaternion(0.17191719858722734, 0.8660099187958344, -0.06205014484506926, 0.4654256942862719), new Quaternion(0.1680961487899986, 0.8803806542414948, -0.0709029126209659, 0.43777433156953377), new Quaternion(0.17227859843437948, 0.8661652992480947, -0.06162609913414136, 0.46505911753824747), new Quaternion(0.16786286828722055, 0.8802849592607325, -0.07196906778871824, 0.4378822915251776), new Quaternion(0.17222569718001962, 0.8659667091129386, -0.06261514226363764, 0.4653163567920946), new Quaternion(0.16889206298820142, 0.8801770433104215, -0.0709176887141695, 0.4378750106095963), new Quaternion(0.17095982759866496, 0.8657295361101189, -0.06614731577768986, 0.4657355905118264), new Quaternion(0.16986936185433701, 0.8801377818862584, -0.06983045965957392, 0.43775060445791536), new Quaternion(0.17154496712934023, 0.8657717430197173, -0.06594229931121456, 0.46547097267471427), new Quaternion(0.17018266618401784, 0.8801116746899754, -0.07034610870346564, 0.43759881763458447), new Quaternion(0.17310654102449638, 0.8658175426225683, -0.06387511447901938, 0.4650957730315811), new Quaternion(0.16939082335530684, 0.8800540953504273, -0.07284556632295824, 0.4376129130716322), new Quaternion(0.17271699879268915, 0.8657339649248852, -0.06599174492369392, 0.4651006664211632), new Quaternion(0.173216684433894, 0.8799200095457523, -0.06685635322059653, 0.43734081111734213), new Quaternion(0.17187464805639935, 0.865750733439395, -0.06826804796443138, 0.46505295024520005), new Quaternion(0.1721957949342169, 0.8800090547447332, -0.06963142316694347, 0.43713171548401775), new Quaternion(0.17495612454467757, 0.8655511622661857, -0.06304778758585178, 0.4650123831302686), new Quaternion(0.17020842549440848, 0.8798473016443965, -0.07347184394289465, 0.4376067936257614), new Quaternion(0.17645126855942495, 0.8660246927759337, -0.06004894052286307, 0.4639615351170839), new Quaternion(0.16900256410574888, 0.8795577562343924, -0.07619061372061273, 0.4381909140482945), new Quaternion(0.17701565809996855, 0.8661070153501444, -0.05977104234637695, 0.4636286415284622), new Quaternion(0.16976369448741777, 0.8796807068674035, -0.07587413794337478, 0.43770453183694336), new Quaternion(0.17642416627327231, 0.8658069256555055, -0.06248697247276295, 0.46405631049790813), new Quaternion(0.17317605147072948, 0.8799818889060802, -0.07117532122126215, 0.4365501163020629), new Quaternion(0.1737367733354437, 0.8657350637779062, -0.06902693944778898, 0.4642775189118302), new Quaternion(0.17463683600422275, 0.8798753108745638, -0.06897843174810989, 0.4365356672454101), new Quaternion(0.17354123165679924, 0.8657820348763, -0.06986059833386901, 0.4641383476948744), new Quaternion(0.1746186877237057, 0.8799188292861102, -0.0693214755003918, 0.43640084876161833), new Quaternion(0.17396487142561862, 0.8656162658220007, -0.0701036285590046, 0.4642522860655666), new Quaternion(0.17664275904509144, 0.8794036020617179, -0.0665211060206304, 0.4370601592591179), new Quaternion(0.1723987084737089, 0.8658453466081365, -0.0741617742915289, 0.46377855956001846), new Quaternion(0.17652742693955042, 0.8794747967111131, -0.06754713743209143, 0.4368060596108738), new Quaternion(0.174090868187471, 0.8656276890043815, -0.07149041899402109, 0.46397219058336453), new Quaternion(0.17764380561522533, 0.8793210508817606, -0.06663703627047135, 0.43680278524732896), new Quaternion(0.17274365070161188, 0.8659571764655066, -0.07492442985386666, 0.46331860472167535), new Quaternion(0.17825133590612818, 0.8791800168398207, -0.06600937655201747, 0.4369344589803226), new Quaternion(0.1743601333593306, 0.8655725350452665, -0.07305000617244463, 0.46373098566780424), new Quaternion(0.1778590216449416, 0.8793291818206868, -0.06797158696240746, 0.4364930947722743), new Quaternion(0.17440272705226817, 0.8656347277372985, -0.07412468730974912, 0.463428244351957), new Quaternion(0.17801292372076835, 0.8793136253515837, -0.06894510347030089, 0.43630897305339505), new Quaternion(0.1771791079828662, 0.8651507098545946, -0.06955576405055452, 0.4639868625509029), new Quaternion(0.17778567855730346, 0.8793271786136202, -0.07030851669151618, 0.43615671258386973), new Quaternion(0.17646753411350688, 0.8652810279339055, -0.07223537060234786, 0.46360543928591214), new Quaternion(0.1779259016860617, 0.8793291174713812, -0.07134259861652159, 0.4359276434212973), new Quaternion(0.17822551201421685, 0.8651063442635224, -0.06962341481441855, 0.46365855981730103), new Quaternion(0.17833928695102633, 0.8793662848226825, -0.07149877178752355, 0.4356580786348716), new Quaternion(0.17819814284212043, 0.8650952237851803, -0.07098696093092875, 0.4634830385779817), new Quaternion(0.17974440712005116, 0.8791638659643637, -0.06960429289984975, 0.43579592391573346), new Quaternion(0.17833377482936552, 0.8651626392430278, -0.07178213256980279, 0.4631824671302652), new Quaternion(0.17996975063881776, 0.8792526384964727, -0.0706341882203597, 0.4353578964558283), new Quaternion(0.17980910601698374, 0.8650239788059426, -0.07015380111399817, 0.46312055198767305), new Quaternion(0.17865381705673297, 0.8792302717210206, -0.07431729531951793, 0.4353319222809548), new Quaternion(0.1815127132800353, 0.864899925577771, -0.0678179946999255, 0.46303560689019047), new Quaternion(0.17819788327716224, 0.8792058721322338, -0.0760210161617598, 0.43527388378522175), new Quaternion(0.18307724428720212, 0.8650463686955373, -0.0657127420891289, 0.46244928171421823), new Quaternion(0.17570828528947124, 0.8786160539069345, -0.08174797268879601, 0.4364375067050405), new Quaternion(0.1828079705511466, 0.865064635891756, -0.06685665212766248, 0.4623576642586511), new Quaternion(0.1774147012225422, 0.8790608409263668, -0.07913298145154066, 0.4353320950567912), new Quaternion(0.1840918379603947, 0.8653074445114203, -0.06515208651592559, 0.46163668321754997), new Quaternion(0.17791239447422613, 0.8790253632812487, -0.0791432447388291, 0.43519873323911), new Quaternion(0.1833279979568156, 0.8649797903984985, -0.06750468871425078, 0.46221631772245747), new Quaternion(0.17923496077463127, 0.8792491974353249, -0.07716923866658129, 0.4345579204767457), new Quaternion(0.1821356871053094, 0.8649302914580597, -0.07103173391738717, 0.46225174437490474), new Quaternion(0.1802840539532363, 0.8792254113715798, -0.07573004064714177, 0.434425248842934), new Quaternion(0.183870752097195, 0.8649515206792466, -0.06771238020499898, 0.4620232104178797), new Quaternion(0.1774715157872048, 0.8788745499901961, -0.08147821072029754, 0.4352524412815407), new Quaternion(0.18520533205850673, 0.8652968814178963, -0.06592973218606644, 0.46110038212891885), new Quaternion(0.17743692244855092, 0.8787058354502518, -0.08262393177087647, 0.4353911795114637), new Quaternion(0.18612128973932135, 0.8653725626259229, -0.06545614805995313, 0.46065679854005), new Quaternion(0.17711845181929253, 0.8783666536087715, -0.08459253854273942, 0.43582700498725463), new Quaternion(0.18739892278183287, 0.8658201180260601, -0.06401399377347947, 0.4594990484894577), new Quaternion(0.1753530658254341, 0.877388042542588, -0.08899334262122786, 0.4376319344814861), new Quaternion(0.18888383371746154, 0.8666115509715738, -0.06287300210652133, 0.4575525135860922), new Quaternion(0.1747266848237889, 0.8764722954102038, -0.09166309855184784, 0.43916372499642), new Quaternion(0.1901474916443974, 0.8679565838923725, -0.0613368814968935, 0.4546791031787835), new Quaternion(0.17352560861995606, 0.874976689769348, -0.09437562378963164, 0.442038343526516), new Quaternion(0.19046119261966202, 0.8686235430913647, -0.06137996574862643, 0.4532661186301018), new Quaternion(0.173731334536142, 0.8752501787527858, -0.09497896537923865, 0.44128623831816605), new Quaternion(0.19080245426062042, 0.8688477598397724, -0.06180434465042538, 0.4526347497175451), new Quaternion(0.1731606601574267, 0.8736905504903945, -0.09659549375639873, 0.44424038351279277), new Quaternion(0.19085687741176263, 0.8691455083651195, -0.0622711991406651, 0.45197570221302064), new Quaternion(0.17315068604209805, 0.8727800552851795, -0.09783895607053683, 0.4457593001773238), new Quaternion(0.191349114571495, 0.8695458212338616, -0.06306063497066865, 0.45088683441028765), new Quaternion(0.1737257149490194, 0.8733344016966169, -0.09862018019752491, 0.4442752061914689), new Quaternion(0.19156613771077913, 0.868851961265741, -0.06393620902271298, 0.452007572351453), new Quaternion(0.17548212390254395, 0.8764403316474332, -0.09637009509417505, 0.43791685743292574), new Quaternion(0.1907271465901481, 0.8678262430616578, -0.06611425656620967, 0.4540150575540044), new Quaternion(0.17570325934383987, 0.876790038149134, -0.0963711019365746, 0.4371272176036651), new Quaternion(0.19110478366078845, 0.868222776586068, -0.06592792189566886, 0.4531243548890973), new Quaternion(0.17476575710567938, 0.8752701815999991, -0.09896103815332445, 0.4399610804068921), new Quaternion(0.1913573812583022, 0.8681690009151457, -0.06694414224163504, 0.45297176546391316), new Quaternion(0.17468836520975006, 0.8748623549167842, -0.10020621738699906, 0.4405207702331337), new Quaternion(0.19143875301713234, 0.8679961109254348, -0.0676930596454376, 0.45315737325724365), new Quaternion(0.17563766935997024, 0.8758405294251316, -0.09943615318226388, 0.43836882594274), new Quaternion(0.19168044654977623, 0.8678826856729174, -0.06829493442354014, 0.45318214026120546), new Quaternion(0.17777580099993076, 0.8778179075485005, -0.09656805330383099, 0.4341728881990603), new Quaternion(0.19203576960659824, 0.8680904275427218, -0.0685724297924072, 0.4525915318172241), new Quaternion(0.17565632267738568, 0.8749138388586928, -0.10159942811224336, 0.43971375585063144), new Quaternion(0.19257786388116802, 0.8691862244829311, -0.06815609455979464, 0.4503152454519282), new Quaternion(0.17522747410755787, 0.8744831820820131, -0.10261082443433256, 0.44050597644357586), new Quaternion(0.1924853421330573, 0.8690059659741235, -0.06905860740451598, 0.4505651261567516), new Quaternion(0.17529527526359096, 0.8744669511579298, -0.10350048216767559, 0.44030304109087803), new Quaternion(0.19298192606134038, 0.869680495688399, -0.06945946189647474, 0.44898685368937935), new Quaternion(0.17502719565066985, 0.8705167467931668, -0.10526926322700597, 0.44775490679047514), new Quaternion(0.19333834458632887, 0.8694892775348974, -0.07031934394914913, 0.44907000638098893), new Quaternion(0.17621862414130948, 0.8661019070355815, -0.10388911726206818, 0.4560937781307491), new Quaternion(0.1930363342519237, 0.8708466353397524, -0.0720494820497035, 0.4462868847640289), new Quaternion(0.17522421107146963, 0.8707114594733354, -0.10782558216032115, 0.4466896842641245), new Quaternion(0.19358327427868477, 0.8693568391297564, -0.07290321352668093, 0.44880878293026477), new Quaternion(0.175626691686815, 0.8686049109459087, -0.10826044812177803, 0.4505113197470916), new Quaternion(0.19386882827890187, 0.8701767693599973, -0.07402369723572068, 0.44690911798207705), new Quaternion(0.17730211207205138, 0.865569257159059, -0.10667327334813334, 0.45604236082747746), new Quaternion(0.19403708628935895, 0.8704022937653071, -0.07536247783103583, 0.44617255976538345), new Quaternion(0.1833610534074327, 0.8594686883127447, -0.09550177820916743, 0.46751653260839177), new Quaternion(0.19423728452773922, 0.8705286212621013, -0.07597737028737371, 0.4457344905512816), new Quaternion(0.18251761024398444, 0.8602806463280149, -0.09842373477574917, 0.46574381363263523)]);
    avg.equals(new Quaternion(0.16567105278649832, 0.8748424696251375, -0.06645335407268901, 0.4503195613575915)).should.equal(true);
  });
});

describe("Euler angles", function() {
  it("equals (90,0,0) for Quaternion(1/sqrt(2),0,0,1/sqrt(2))", function() {
    var eulerAngles = (new Quaternion(invsqrt2,0,0,invsqrt2)).eulerAngles;
    dEqual(eulerAngles.x,90).should.equal(true);
    dEqual(eulerAngles.y,0).should.equal(true);
    dEqual(eulerAngles.z,0).should.equal(true);
  });

  it("equals (0,90,0) for Quaternion(0,1/sqrt(2),0,1/sqrt(2))", function() {
    var eulerAngles = (new Quaternion(0,invsqrt2,0,invsqrt2)).eulerAngles;
    dEqual(eulerAngles.x,0).should.equal(true);
    dEqual(eulerAngles.y,90).should.equal(true);
    dEqual(eulerAngles.z,0).should.equal(true);
  });

  it("equals (0,0,90) for Quaternion(0,0,1/sqrt(2),1/sqrt(2))", function() {
    var eulerAngles = (new Quaternion(0,0,invsqrt2,invsqrt2)).eulerAngles;
    dEqual(eulerAngles.x,0).should.equal(true);
    dEqual(eulerAngles.y,0).should.equal(true);
    dEqual(eulerAngles.z,90).should.equal(true);
  });

  it("equals (41, 222, 196) when created from (139,42,16)", function() {
    var eulerAngles = (Quaternion.Euler(139,42,16)).eulerAngles;
    dEqual(eulerAngles.x,41).should.equal(true);
    dEqual(eulerAngles.y,222).should.equal(true);
    dEqual(eulerAngles.z,196).should.equal(true);
  });

  it("equals ZXY (357.49933849719724, 47.128045514745146, 70.2459380619192) for Quaternion(0.213589, 0.338412, 0.534368, 0.744519)", function() {
    var eulerAngles = new Quaternion(0.213589, 0.338412, 0.534368, 0.744519).getEulerAngles();
    dEqual(eulerAngles.x,357.49933849719724).should.equal(true);
    dEqual(eulerAngles.y,47.128045514745146).should.equal(true);
    dEqual(eulerAngles.z,70.2459380619192).should.equal(true);
  });

  it("equals XYZ (45.00001966128281, 16.000032244738943, 78.00004142168498) for Quaternion(0.213589, 0.338412, 0.534368, 0.744519)", function() {
    var eulerAngles = new Quaternion(0.213589, 0.338412, 0.534368, 0.744519).getEulerAngles("XYZ");
    dEqual(eulerAngles.x,45.00001966128281).should.equal(true);
    dEqual(eulerAngles.y,16.000032244738943).should.equal(true);
    dEqual(eulerAngles.z,78.00004142168498).should.equal(true);
  });

  it("equals XYZ (40, 30, 25) for euler angles (40,30,25,XYZ)", function() {
    var eulerAngles = Quaternion.Euler(40,30,25,"XYZ").getEulerAngles("XYZ");
    dEqual(eulerAngles.x,40).should.equal(true);
    dEqual(eulerAngles.y,30).should.equal(true);
    dEqual(eulerAngles.z,25).should.equal(true);
  });

  it("equals (90,0,90) when the rotations (0,0,90) and (90,0,0) are applied respectively", function() {
    var q1 = Quaternion.Euler(0,0,90);
    var q2 = Quaternion.Euler(90,0,0);
    var mul = q2.mul(q1);
    mul.equals(Quaternion.Euler(90,0,90)).should.equal(true);
  });

  it("equals (0,40,30) when the rotations (0,0,30) and (0,40,0) are applied respectively", function() {
    var q1 = Quaternion.Euler(0,0,30);
    var q2 = Quaternion.Euler(0,40,0);
    var mul = q2.mul(q1);
    mul.equals(Quaternion.Euler(0,40,30)).should.equal(true);
  });

  var q = Quaternion.Euler(90,0,0);
  it("has distance 1 to its inverse for (90,0,0)", function() {
    q.distanceTo(q.inverse()).should.equal(1);
  });

  it("has angle 180 to its inverse for (90,0,0)", function() {
    q.angleTo(q.inverse()).should.equal(180);
  });
});
